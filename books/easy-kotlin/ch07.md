# [第 7 章 面向对象编程](https://github.com/EasyKotlin/chatper7_oop)

---

[TOC]

## 7.9 单例模式与伴生对象

### 7.9.1 单例模式

N/A

### 7.9.2 `object` 对象

```java
package com.easy.kotlin

import sun.misc.BASE64Encoder
import java.io.UnsupportedEncodingException
import java.security.MessageDigest
import java.security.NoSuchAlgorithmException
import java.text.SimpleDateFormat
import java.util.*

/**
 * 7.9.2 object 对象
 */

object AdminUser {
    const val username: String = "admin"
    private const val password: String = "admin"
    private fun getTimestamp() = SimpleDateFormat("yyyyMMddHHmmss").format(Date())
    fun md5Password() = encodeByMd5(password + getTimestamp())
}

@Throws(NoSuchAlgorithmException::class, UnsupportedEncodingException::class)
fun encodeByMd5(str: String): String {
    val md5 = MessageDigest.getInstance("MD5")
    val base64en = BASE64Encoder()
    return base64en.encode(md5.digest(str.toByteArray(charset("utf-8"))))
}

fun main(args: Array<String>) {
    val adminUser = AdminUser.username
    val adminPassword = AdminUser.md5Password()
    println(adminUser)
    println(adminPassword)
}
```

### 7.9.4 匿名 `object`

```java
package com.easy.kotlin

/**
 * 7.9.4 匿名 object
 */

fun distance(x: Double, y: Double): Double {
    val origin = object {
        var x = 0.0
        var y = 0.0
    }
    return Math.sqrt((x - origin.x) * (x - origin.x) + (y - origin.y) * (y - origin.y))
}

fun main(args: Array<String>) {
    println(distance(3.0, 4.0))
}
```

```java
package com.easy.kotlin

/**
 * 7.9.4 匿名 object
 *
 * 匿名对象只可以用在本地和私有作用域中声明的类型
 */

class AnonymousObjectType {
    // 私有函数，返回的是匿名 object 类型。
    private fun privateFoo() = object {
        val x: String = "x"
    }

    // 公有函数，返回的是 Any 类型。
    fun publicFoo() = object {
        val x: String = "x" // 无法访问到
    }

    fun test() {
        val x1 = privateFoo().x
        println(x1)
        // val x2 = publicFoo().x // Error: Kotlin: Unresolved reference: x
    }
}

fun main(args: Array<String>) {
    AnonymousObjectType().test()
}
```

```java
package com.easy.kotlin

import java.util.*

/**
 * 7.9.4 匿名 object
 *
 * object 对象表达式可以访问包含它的作用域的变量
 */

fun countCompare() {

    val list = mutableListOf(1, 4, 3, 7, 11, 9, 10, 20)

    var countCompare = 0

    Collections.sort(list, object : Comparator<Int> { // 实现了某个接口的匿名对象

        override fun compare(o1: Int, o2: Int): Int {
            countCompare++ // 访问外部变量
            println("countCompare=$countCompare")
            println(list) // 访问外部变量
            return o1.compareTo(o2)
        }
    })
}

fun main(args: Array<String>) {
    countCompare()
}
```