# 第 5 章 集合类

---

[TOC]

## 5.3 `List`

### 5.3.1 创建不可变 `List`

`listOf` 函数创建的 `List` 都是只读的（也就是不可变的 immutable）、可序列化的。

```bash
# 创建没有元素的 List
>>> val list: List<Int> = listOf()
>>> list
[]
>>> list::class
class kotlin.collections.EmptyList
```

```bash
# 注意：变量的类型不能省略，因为 listOf 是泛型函数。
>>> val list = listOf()
error: type inference failed: Not enough information to infer parameter T in inline fun <T> listOf(): List<T>
Please specify it explicitly.

val list = listOf()
           ^
```

```bash
# 创建只有一个元素的 List
>>> val list = listOf(1)
>>> list::class
class java.util.Collections$SingletonList
```

```bash
# 创建有多个元素的 List
>>> val list = listOf(10, 20, 30)
>>> list
[10, 20, 30]
>>> list::class
class java.util.Arrays$ArrayList
```

```bash
# 直接使用 arrayListOf 函数创建 Java 中的 ArrayList 对象实例
>>> val list = arrayListOf(10, 20, 30)
>>> list
[10, 20, 30]
>>> list::class
class java.util.ArrayList
```

### 5.3.2 创建可变集合的 `MutableList`

```bash
>>> val list = mutableListOf(10, 20, 30)
>>> list
[10, 20, 30]
>>> list::class
class java.util.ArrayList
>>> list.add(40)
true
>>> list
[10, 20, 30, 40]
```

```bash
>>> val list = mutableListOf<Int>()
>>> list
[]
>>> list::class
class java.util.ArrayList
>>> list.add(100)
true
>>> list
[100]
```

```bash
>>> val list = mutableListOf(10)
>>> list
[10]
>>> list::class
class java.util.ArrayList
>>> list.add(20)
true
>>> list
[10, 20]
```

```bash
>>> val list = listOf(10, 20, 30)
>>> list.add(40)
error: unresolved reference: add
list.add(40)
     ^

# 不可变 List 转换成可变
>>> val mlist = list.toMutableList()
>>> mlist.add(40)
true
>>> mlist
[10, 20, 30, 40]
```

### 5.3.3 遍历 `List` 元素

使用 `Iterator` 迭代器

```bash
>>> val list = listOf(10, 20, 30)
>>> list
[10, 20, 30]
>>> val iterator = list.iterator()
>>> iterator
java.util.AbstractList$Itr@2d5b3f1a
>>> iterator.hasNext()
true
>>> iterator.next()
10
>>> iterator.next()
20
>>> iterator.next()
30
>>> iterator.next()
java.util.NoSuchElementException
        at java.util.AbstractList$Itr.next(AbstractList.java:364)
```

使用 `forEach` 函数

```bash
>>> val list = listOf(10, 20, 30)
>>> list
[10, 20, 30]
# 以下三种写法等价
>>> list.forEach { println(it) } # 尾随闭包
10
20
30
>>> list.forEach({ println(it) })
10
20
30
>>> list.forEach(::println)
10
20
30
```

### 5.3.4 `List` 元素操作函数

- **`add`/`remove`**

```bash
>>> val mutableList = mutableListOf(1, 2, 3)
>>> mutableList
[1, 2, 3]
# 在最后的位置添加元素
>>> mutableList.add(4)
true
>>> mutableList
[1, 2, 3, 4]
# 在下标为 0 的位置添加元素
>>> mutableList.add(0, 0)
>>> mutableList
[0, 1, 2, 3, 4]
# 删除元素 1
>>> mutableList.remove(1)
true
>>> mutableList
[0, 2, 3, 4]
>>> mutableList.remove(1)
false
# 删除下标为 1 的元素
>>> mutableList.removeAt(1)
2
>>> mutableList
[0, 3, 4]
# 删除子集合
>>> mutableList.removeAll(listOf(3, 4))
true
>>> mutableList
[0]
# 添加子集合
>>> mutableList.addAll(listOf(10, 20, 30))
true
>>> mutableList
[0, 10, 20, 30]
```

- **`set`/`clear`**

```bash
## 接上一小节
# 更新下标为 0 的元素的值为 100
>>> mutableList.set(0, 100)
0
>>> mutableList
[100, 10, 20, 30]
# 清空集合
>>> mutableList.clear()
>>> mutableList
[]
# 把可变集合转为不可变集合（注意：返回的是一个新的集合）
>>> val list = mutableList.toList()
>>> list.add(13)
error: unresolved reference: add
list.add(13)
     ^
>>> mutableList.add(13) # 原来的集合仍然可以添加元素
true
>>> mutableList
[13]
```

- **`retainAll`**

取两个集合的交集

```bash
>>> val mlist1 = mutableListOf(1, 2, 3, 4, 5, 6)
>>> val mlist2 = mutableListOf(3, 4, 5, 6, 7, 8, 9)  
>>> mlist1.retainAll(mlist2)
true
>>> mlist1
[3, 4, 5, 6]
>>> mlist2
[3, 4, 5, 6, 7, 8, 9]
```

- **`contains`**

判断集合中是否包含指定元素

```bash
>>> val list = listOf(1, 2, 3, 4, 5, 6, 7)
>>> list.contains(1)
true
```

- **`elementAt`**

查找下标对应的元素，越界则抛出异常。

```bash
## 接上一小节
>>> list.elementAt(6)
7
# 越界抛出异常
>>> list.elementAt(7)
java.lang.ArrayIndexOutOfBoundsException: 7
        at java.util.Arrays$ArrayList.get(Arrays.java:3841)
# 越界返回默认值
>>> list.elementAtOrElse(7, {0})
0
>>> list.elementAtOrElse(7, {10})
10
# 越界返回 null
>>> list.elementAtOrNull(7)
null
```

- **`first`**

返回集合第一个元素，空集则抛出异常。

```bash
## 接上一小节
>>> list.first()
1
>>> val emptyList = listOf<Int>()
>>> emptyList.first()
java.util.NoSuchElementException: List is empty.
        at kotlin.collections.CollectionsKt___CollectionsKt.first(_Collections.kt:178)
# 异常处理
>>> emptyList.firstOrNull()
null
```

返回符合条件的第一个元素，没有则抛出异常。

```bash
# 返回第一个符合条件的元素
>>> list.first({it % 2 == 0})
2
>>> list.first({it > 100})
java.util.NoSuchElementException: Collection contains no element matching the predicate.
# 异常处理
>>> list.firstOrNull({it > 100})
null
```

- **`indexOf`**

返回元素的下标，没有则返回 -1。

```bash
>>> val list = listOf("a", "b", "c")
>>> list.indexOf("c")
2
>>> list.indexOf("x")
-1
```

- **`indexOfFirst`**

返回符合条件的第一个元素的下标，没有则返回 -1。

```bash
>>> val list = listOf("abc", "xyz", "xjk", "pqk")
>>> list.indexOfFirst({it.contains("x")})
1
>>> list.indexOfFirst({it.contains("k")})
2
>>> list.indexOfFirst({it.contains("e")})
-1
```

- **`indexOfLast`**

返回符合条件的最后一个元素的下标，没有则返回 -1。

```bash
## 接上一小节
>>> list.indexOfLast({it.contains("x")})
2
>>> list.indexOfLast({it.contains("k")})
3
>>> list.indexOfLast({it.contains("e")})
-1
```

- **`last`**

返回最后一个元素，空集则抛出异常。

```bash
## 接上一小节
>>> list.last()
pqk
>>> val emptyList = listOf<Int>()
# 抛出异常
>>> emptyList.last()
java.util.NoSuchElementException: List is empty.
        at kotlin.collections.CollectionsKt___CollectionsKt.last(_Collections.kt:341)
```

返回符合条件的最后一个元素，没有则抛出异常。

```bash
>>> list.last({it.contains("x")})
xjk
# 没有符合条件的
>>> list.last({it.contains("w")})
java.util.NoSuchElementException: List contains no element matching the predicate.
# 异常处理
>>> list.lastOrNull({it.contains("w")})
null
```

- **`lastIndexOf`**

返回最后一个相等元素的下标，没有则返回 -1。

```bash
>>> val list = listOf("abc", "dfg", "jkl", "abc", "bbc", "wer") 
>>> list.lastIndexOf("abc")
3
```

- **`single`**

该集合如果只有一个元素，则返回该元素，否则，抛出异常。

```bash
# 只有一个元素的集合
>>> val list = listOf(1)
>>> list.single()
1
# 多个元素的集合
>>> val list = listOf(1, 2, 3)
>>> list.single()
java.lang.IllegalArgumentException: List has more than one element.
        at kotlin.collections.CollectionsKt___CollectionsKt.single(_Collections.kt:474)
# 空集
>>> val list = listOf<Int>()
>>> list.single()
java.util.NoSuchElementException: List is empty.
        at kotlin.collections.CollectionsKt___CollectionsKt.single(_Collections.kt:472)
```

返回符合条件的单个元素，如果符合条件的有多个或没有符合条件的都会抛出异常。

```bash
>>> val list = listOf(1, 2, 3, 4, 5, 6, 7)
# 符合条件的元素只有一个
>>> list.single({it == 1})
1
>>> list.single({it == 7})
7
# 符合条件的有多个
>>> list.single({it < 7})
java.lang.IllegalArgumentException: Collection contains more than one matching element.
# 没有符合条件的
>>> list.single({it > 7})
java.util.NoSuchElementException: Collection contains no element matching the predicate.
# 异常处理
>>> list.singleOrNull({it > 7})
null
```

### 5.3.5 `List` 集合类的基本运算函数