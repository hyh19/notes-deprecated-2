# 第 5 章 集合类

---

[TOC]

## 5.3 `List`

### 5.3.1 创建不可变 `List`

`listOf` 函数创建的 `List` 都是只读的（也就是不可变的 immutable）、可序列化的。

```bash
# 创建没有元素的 List
>>> val list: List<Int> = listOf()
>>> list
[]
>>> list::class
class kotlin.collections.EmptyList
```

```bash
# 注意：变量的类型不能省略，因为 listOf 是泛型函数。
>>> val list = listOf()
error: type inference failed: Not enough information to infer parameter T in inline fun <T> listOf(): List<T>
Please specify it explicitly.

val list = listOf()
           ^
```

```bash
# 创建只有一个元素的 List
>>> val list = listOf(1)
>>> list::class
class java.util.Collections$SingletonList
```

```bash
# 创建有多个元素的 List
>>> val list = listOf(10, 20, 30)
>>> list
[10, 20, 30]
>>> list::class
class java.util.Arrays$ArrayList
```

```bash
# 直接使用 arrayListOf 函数创建 Java 中的 ArrayList 对象实例
>>> val list = arrayListOf(10, 20, 30)
>>> list
[10, 20, 30]
>>> list::class
class java.util.ArrayList
```

### 5.3.2 创建可变集合的 `MutableList`

```bash
>>> val list = mutableListOf(10, 20, 30)
>>> list
[10, 20, 30]
>>> list::class
class java.util.ArrayList
>>> list.add(40)
true
>>> list
[10, 20, 30, 40]
```

```bash
>>> val list = mutableListOf<Int>()
>>> list
[]
>>> list::class
class java.util.ArrayList
>>> list.add(100)
true
>>> list
[100]
```

```bash
>>> val list = mutableListOf(10)
>>> list
[10]
>>> list::class
class java.util.ArrayList
>>> list.add(20)
true
>>> list
[10, 20]
```

```bash
>>> val list = listOf(10, 20, 30)
>>> list.add(40)
error: unresolved reference: add
list.add(40)
     ^

# 不可变 List 转换成可变
>>> val mlist = list.toMutableList()
>>> mlist.add(40)
true
>>> mlist
[10, 20, 30, 40]
```

### 5.3.3 遍历 `List` 元素

使用 `Iterator` 迭代器

```bash
>>> val list = listOf(10, 20, 30)
>>> list
[10, 20, 30]
>>> val iterator = list.iterator()
>>> iterator
java.util.AbstractList$Itr@2d5b3f1a
>>> iterator.hasNext()
true
>>> iterator.next()
10
>>> iterator.next()
20
>>> iterator.next()
30
>>> iterator.next()
java.util.NoSuchElementException
        at java.util.AbstractList$Itr.next(AbstractList.java:364)
```

使用 `forEach` 函数

```bash
>>> val list = listOf(10, 20, 30)
>>> list
[10, 20, 30]
# 以下三种写法等价
>>> list.forEach { println(it) } # 尾随闭包
10
20
30
>>> list.forEach({ println(it) })
10
20
30
>>> list.forEach(::println)
10
20
30
```

### 5.3.4 `List` 元素操作函数

- **`add`/`remove`**

```bash
>>> val mutableList = mutableListOf(1, 2, 3)
>>> mutableList
[1, 2, 3]
# 在最后的位置添加元素
>>> mutableList.add(4)
true
>>> mutableList
[1, 2, 3, 4]
# 在下标为 0 的位置添加元素
>>> mutableList.add(0, 0)
>>> mutableList
[0, 1, 2, 3, 4]
# 删除元素 1
>>> mutableList.remove(1)
true
>>> mutableList
[0, 2, 3, 4]
>>> mutableList.remove(1)
false
# 删除下标为 1 的元素
>>> mutableList.removeAt(1)
2
>>> mutableList
[0, 3, 4]
# 删除子集合
>>> mutableList.removeAll(listOf(3, 4))
true
>>> mutableList
[0]
# 添加子集合
>>> mutableList.addAll(listOf(10, 20, 30))
true
>>> mutableList
[0, 10, 20, 30]
```

- **`set`/`clear`**

```bash
## 接上一小节
# 更新下标为 0 的元素的值为 100
>>> mutableList.set(0, 100)
0
>>> mutableList
[100, 10, 20, 30]
# 清空集合
>>> mutableList.clear()
>>> mutableList
[]
# 把可变集合转为不可变集合（注意：返回的是一个新的集合）
>>> val list = mutableList.toList()
>>> list.add(13)
error: unresolved reference: add
list.add(13)
     ^
>>> mutableList.add(13) # 原来的集合仍然可以添加元素
true
>>> mutableList
[13]
```

- **`retainAll`**

取两个集合的交集

```bash
>>> val mlist1 = mutableListOf(1, 2, 3, 4, 5, 6)
>>> val mlist2 = mutableListOf(3, 4, 5, 6, 7, 8, 9)  
>>> mlist1.retainAll(mlist2)
true
>>> mlist1
[3, 4, 5, 6]
>>> mlist2
[3, 4, 5, 6, 7, 8, 9]
```

- **`contains`**

判断集合中是否包含指定元素

```bash
>>> val list = listOf(1, 2, 3, 4, 5, 6, 7)
>>> list.contains(1)
true
```

- **`elementAt`**

查找下标对应的元素，越界则抛出异常。

```bash
## 接上一小节
>>> list.elementAt(6)
7
# 越界抛出异常
>>> list.elementAt(7)
java.lang.ArrayIndexOutOfBoundsException: 7
        at java.util.Arrays$ArrayList.get(Arrays.java:3841)
# 越界返回默认值
>>> list.elementAtOrElse(7, { 0 })
0
>>> list.elementAtOrElse(7, { 10 })
10
# 越界返回 null
>>> list.elementAtOrNull(7)
null
```

- **`first`**

返回集合第一个元素，空集则抛出异常。

```bash
## 接上一小节
>>> list.first()
1
>>> val emptyList = listOf<Int>()
>>> emptyList.first()
java.util.NoSuchElementException: List is empty.
        at kotlin.collections.CollectionsKt___CollectionsKt.first(_Collections.kt:178)
# 异常处理
>>> emptyList.firstOrNull()
null
```

返回符合条件的第一个元素，没有则抛出异常。

```bash
# 返回第一个符合条件的元素
>>> list.first({ it % 2 == 0 })
2
>>> list.first({ it > 100 })
java.util.NoSuchElementException: Collection contains no element matching the predicate.
# 异常处理
>>> list.firstOrNull({ it > 100 })
null
```

- **`indexOf`**

返回元素的下标，没有则返回 -1。

```bash
>>> val list = listOf("a", "b", "c")
>>> list.indexOf("c")
2
>>> list.indexOf("x")
-1
```

- **`indexOfFirst`**

返回符合条件的第一个元素的下标，没有则返回 -1。

```bash
>>> val list = listOf("abc", "xyz", "xjk", "pqk")
>>> list.indexOfFirst({ it.contains("x") })
1
>>> list.indexOfFirst({ it.contains("k") })
2
>>> list.indexOfFirst({ it.contains("e") })
-1
```

- **`indexOfLast`**

返回符合条件的最后一个元素的下标，没有则返回 -1。

```bash
## 接上一小节
>>> list.indexOfLast({ it.contains("x") })
2
>>> list.indexOfLast({ it.contains("k") })
3
>>> list.indexOfLast({ it.contains("e") })
-1
```

- **`last`**

返回最后一个元素，空集则抛出异常。

```bash
## 接上一小节
>>> list.last()
pqk
>>> val emptyList = listOf<Int>()
# 抛出异常
>>> emptyList.last()
java.util.NoSuchElementException: List is empty.
        at kotlin.collections.CollectionsKt___CollectionsKt.last(_Collections.kt:341)
```

返回符合条件的最后一个元素，没有则抛出异常。

```bash
>>> list.last({ it.contains("x") })
xjk
# 没有符合条件的
>>> list.last({ it.contains("w") })
java.util.NoSuchElementException: List contains no element matching the predicate.
# 异常处理
>>> list.lastOrNull({ it.contains("w") })
null
```

- **`lastIndexOf`**

返回最后一个相等元素的下标，没有则返回 -1。

```bash
>>> val list = listOf("abc", "dfg", "jkl", "abc", "bbc", "wer")
>>> list.lastIndexOf("abc")
3
```

- **`single`**

该集合如果只有一个元素，则返回该元素，否则，抛出异常。

```bash
# 只有一个元素的集合
>>> val list = listOf(1)
>>> list.single()
1
# 多个元素的集合
>>> val list = listOf(1, 2, 3)
>>> list.single()
java.lang.IllegalArgumentException: List has more than one element.
        at kotlin.collections.CollectionsKt___CollectionsKt.single(_Collections.kt:474)
# 空集
>>> val list = listOf<Int>()
>>> list.single()
java.util.NoSuchElementException: List is empty.
        at kotlin.collections.CollectionsKt___CollectionsKt.single(_Collections.kt:472)
```

返回符合条件的单个元素，如果符合条件的有多个或没有符合条件的都会抛出异常。

```bash
>>> val list = listOf(1, 2, 3, 4, 5, 6, 7)
# 符合条件的元素只有一个
>>> list.single({ it == 1 })
1
>>> list.single({ it == 7 })
7
# 符合条件的有多个
>>> list.single({ it < 7 })
java.lang.IllegalArgumentException: Collection contains more than one matching element.
# 没有符合条件的
>>> list.single({ it > 7 })
java.util.NoSuchElementException: Collection contains no element matching the predicate.
# 异常处理
>>> list.singleOrNull({ it > 7 })
null
```

### 5.3.5 `List` 集合类的基本运算函数

- **`any`**

如果集合至少有一个元素，返回 `true`，否则返回 `false`。

```bash
>>> val emptyList = listOf<Int>()
>>> emptyList.any()
false
>>> val list1 = listOf(1)
>>> list1.any()
true
```

如果集合至少有一个元素满足条件，返回 `true`，否则返回 `false`。

```bash
>>> val list = listOf(1, 2, 3)
>>> list.any({ it % 2 == 0 })
true
>>> list.any({ it > 4 })
false
```

- **`all`**

当且仅当集合中所有元素都满足条件时，返回 `true`，否则返回 `false`。

```bash
>>> val list = listOf(0, 2, 4, 6, 8)
>>> list.all({ it % 2 == 0 })
true
>>> list.all({ it > 4 })
false
```

- **`none`**

如果集合没有任何元素，返回 `true`，否则返回 `false`。

```bash
>>> val list = listOf<Int>()
>>> list.none()
true
```

当且仅当集合中所有元素都不满足条件时，返回 `true`，否则返回 `false`。

```bash
>>> val list = listOf(0, 2, 4, 6, 
>>> list.none({ it % 2 == 1 })
true
>>> list.none({ it > 0 })
false
```

- **`count`**

计算集合中的元素个数

```bash
>>> val list = listOf(0, 2, 4, 6, 8)
>>> list.count()
5
```

计算集合中满足条件的元素个数

```bash
>>> val list = listOf(0, 2, 4, 6, 8, 9)
>>> list.count()
6
>>> list.count({ it % 2 == 0 })
5
```

- **`reduce`**

从第一项到最后一项进行累加运算

```bash
>>> val list = listOf(1, 2, 3, 4, 5, 6, 7, 8, 9)
>>> list.reduce({ sum, next -> sum+next })
45
>>> list.reduce({ sum, next -> sum * next })
362880
>>> val list = listOf("a", "b", "c")
>>> list.reduce({ total, s -> total + s })
abc
```

- **`reduceRight`**

```bash
## 接上一小节
>>> list.reduceRight({ total, s -> s + total })
cba
```

- **`fold`**

带初始值的 `reduce`

```bash
>>> val list = listOf(1, 2, 3, 4)
# total 的初始值是 100
>>> list.fold(100, { total, next -> next + total })
110
```

`foldRight` 和 `reduceRight` 类似，有初始值。

```bash
>>> val list = listOf("a", "b", "c")
>>> list.foldRight("xyz", { s, pre -> pre + s })
xyzcba
```

- **`forEach`**

遍历元素

```bash
>>> val list = listOf(0, 1, 2, 3, 4, 5, 6, 7, 8, 9)
>>> list.forEach { value -> if (value > 7) println(value) }
8
9
```

- **`forEachIndexed`**

带下标遍历元素

```bash
## 接上一小节
>>> list.forEachIndexed { index, value -> if (value > 7) println("$index: $value") }
8: 8
9: 9
```

- **`max`/`min`**

返回集合中最大（小）的元素，空集则返回 `null`。

```bash
## 接上一小节
>>> list.max()
9
>>> list.min()
0
```

- **`maxBy`/`minBy`**

获取函数映射结果的最大（小）值对应的那个元素的值，如果没有则返回 `null`。

```bash
>>> val list = listOf(100, -500, 300, 200)
>>> list.maxBy({ it })
300
>>> list.maxBy({ it * it })
-500 # 注意：返回的不是映射结果
>>> list.minBy({ it * it })
100
```

- **`sumBy`**

计算函数映射值的总和

```bash
>>> val list = listOf(1, 2, 3, 4)
>>> list.sumBy({ it })
10
>>> list.sumBy({ it * it })
30
```

### 5.3.6 过滤操作函数

- **`take`**

挑出集合前 n 个元素的子集合。如果 n 等于 0，返回空集；如果 n 大于集合 `size`，返回该集合。

```bash
>>> val list = listOf("a", "b", "c")
>>> list
[a, b, c]
>>> list.take(2)
[a, b]
>>> list.take(10)
[a, b, c]
>>> list.take(0)
[]
```

- **`takeWhile`**

挑出满足条件的元素的子集合。从第一个元素开始，判断是否满足条件，只要遇到任何一个元素不满足条件，就结束循环。

```bash
>>> val list = listOf(1, 2, 4, 6, 8, 9)
>>> list.takeWhile({ it % 2 == 0 })
[]
>>> list.takeWhile({ it % 2 == 1 })
[1]
>>> val list = listOf(2, 4, 6, 8, 9, 11, 12, 16)
>>> list.takeWhile({ it % 2 == 0 })
[2, 4, 6, 8]
```

- **`takeLast`**

挑出后 n 个元素的子集合。如果 n 等于 0，返回空集；如果 n 大于集合 `size`，返回该集合；如果 n 是负数，抛出异常。

```bash
>>> val list = listOf(2, 4, 6, 8, 9, 11, 12, 16)
>>> list.takeLast(0)
[]
>>> list.takeLast(3)
[11, 12, 16]
>>> list.takeLast(100)
[2, 4, 6, 8, 9, 11, 12, 16]
>>> list.takeLast(-1)
java.lang.IllegalArgumentException: Requested element count -1 is less than zero.
        at kotlin.collections.CollectionsKt___CollectionsKt.takeLast(_Collections.kt:754)
```

- **`takeLastWhile`**

与 `takeWhile` 方向相反。

```bash
>>> val list = listOf(2, 4, 6, 8, 9, 11, 12, 16)
>>> list.takeLastWhile({ it % 2 == 0 })
[12, 16]
```

- **`drop`**

去除前 n 个元素返回剩下元素的子集合。如果 n 等于 0，返回集合；如果 n 大于集合 `size`，返回空集；如果 n 是负数，抛出异常。

```bash
>>> val list = listOf(2, 4, 6, 8, 9, 11, 12, 16)
>>> list.drop(5)
[11, 12, 16]
>>> list.drop(100)
[]
>>> list.drop(0)
[2, 4, 6, 8, 9, 11, 12, 16]
>>> list.drop(-1)
java.lang.IllegalArgumentException: Requested element count -1 is less than zero.
        at kotlin.collections.CollectionsKt___CollectionsKt.drop(_Collections.kt:542)
```

- **`dropWhile`**

去除满足条件的元素，当遇到第一个不满足条件的元素时，终止操作，返回剩下的元素。

```bash
>>> val list = listOf(2, 4, 6, 8, 9, 11, 12, 16)
>>> list.dropWhile({ it % 2== 0 })
[9, 11, 12, 16]
```

- **`dropLast`**

与 `drop` 方向相反。

```bash
>>> val list = listOf(2, 4, 6, 8, 9, 11, 12, 16)
>>> list.dropLast(3)
[2, 4, 6, 8, 9]
>>> list.dropLast(100)
[]
>>> list.dropLast(0)
[2, 4, 6, 8, 9, 11, 12, 16]
>>> list.dropLast(-1)
java.lang.IllegalArgumentException: Requested element count -1 is less than zero.
        at kotlin.collections.CollectionsKt___CollectionsKt.dropLast(_Collections.kt:577)
```

- **`dropLastWhile`**

与 `dropWhile` 方向相反。

```bash
>>> val list = listOf(2, 4, 6, 8, 9, 11, 12, 16)
>>> list.dropLastWhile({ it % 2 == 0 })
[2, 4, 6, 8, 9, 11]
```

- **`slice`**

取开始下标至结束下标的元素子集合。

```bash
>>> val list = listOf(2, 4, 6, 8, 9, 11, 12, 16)
>>> list.slice(1..3)
[4, 6, 8]
>>> list.slice(2..7)
[6, 8, 9, 11, 12, 16]
```

返回指定下标的元素子集合。

```bash
>>> val list = listOf(2, 4, 6, 8, 9, 11, 12, 16)
# 取下标为 2 4 6 的元素，而不是元素 2 4 6。
>>> list.slice(listOf(2, 4, 6))
[6, 9, 12]
```

- **`filterTo`**

筛选出满足条件的元素并赋值给另一个集合。

```bash
>>> val list = listOf(1, 2, 3, 4, 5, 6, 7)
>>> val dest = mutableListOf<Int>()
>>> list.filterTo(dest, { it > 3 })
[4, 5, 6, 7]
>>> dest
[4, 5, 6, 7]
```

- **`filter`**

筛选出满足条件的元素。

```bash
>>> val list = listOf(1, 2, 3, 4, 5, 6, 7)
>>> list.filter({ it > 3 })
[4, 5, 6, 7]
```